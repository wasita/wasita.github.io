<script>import { createEventDispatcher } from "svelte";
import { slide } from "svelte/transition";
import { flip } from "svelte/animate";
const dispatch = createEventDispatcher();
export let input = void 0;
export let options = [];
export let whitelist = [];
export let blacklist = [];
export let emptyState = "No Results Found.";
export let duration = 200;
export let regionNav = "";
export let regionList = "list-nav";
export let regionItem = "";
export let regionButton = "w-full";
export let regionEmpty = "text-center";
let listedOptions = options;
function whitelistOptions() {
  if (!whitelist.length)
    return;
  listedOptions = [...options].filter((option) => whitelist.includes(option.value));
}
function blacklistOptions() {
  if (!blacklist.length)
    return;
  const toBlacklist = new Set(blacklist);
  listedOptions = [...options].filter((option) => !toBlacklist.has(option.value));
}
function filterOptions() {
  let _options = [...listedOptions];
  _options = _options.filter((option) => {
    const inputFormatted = String(input).toLowerCase().trim();
    let optionFormatted = JSON.stringify([option.label, option.value, option.keywords]).toLowerCase();
    if (optionFormatted.includes(inputFormatted))
      return option;
  });
  return _options;
}
function onSelection(option) {
  dispatch("selection", option);
}
$:
  if (whitelist)
    whitelistOptions();
$:
  if (blacklist)
    blacklistOptions();
$:
  optionsFiltered = input ? filterOptions() : listedOptions;
$:
  classsesBase = `${$$props.class ?? ""}`;
$:
  classesNav = `${regionNav}`;
$:
  classesList = `${regionList}`;
$:
  classesItem = `${regionItem}`;
$:
  classesButton = `${regionButton}`;
$:
  classesEmtpy = `${regionEmpty}`;
</script>

<div class="autocomplete {classsesBase}" data-testid="autocomplete">
	{#if optionsFiltered.length > 0}
		<nav class="autocomplete-nav {classesNav}">
			<ul class="autocomplete-list {classesList}">
				{#each optionsFiltered as option, i (option)}
					<li class="autocomplete-item {classesItem}" animate:flip={{ duration }} transition:slide|local={{ duration }}>
						<button class="autocomplete-button {classesButton}" type="button" on:click={() => onSelection(option)} on:click on:keypress>
							{@html option.label}
						</button>
					</li>
				{/each}
			</ul>
		</nav>
	{:else}
		<div class="autocomplete-empty {classesEmtpy}">{emptyState}</div>
	{/if}
</div>
